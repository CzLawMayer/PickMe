/* =========================
   Search page (cleaned)
   ========================= */

/* Tabs */
.search-page .lib-tabs .lib-tab { cursor: pointer; }
.search-page .lib-tabs .lib-tab.is-active {
  background: var(--bar2, #3949ab);
  color: #fff;
  border-color: transparent;
}

/* Single-column layout variant (no right feature panel) */
.library-layout.library-layout--full { grid-template-columns: 1fr !important; }

/* Identity slot (search lives here) */
.search-identity-slot {
  min-width: 0;
  flex: 1 1 auto;
  display: flex;
  align-items: center;
}

/* ==== Books grid ==== */
.search-page .search-books-grid {
  display: grid;
  grid-template-columns: repeat(4, minmax(0, 1fr));
  gap: var(--gap, clamp(16px, 2vw, 28px));
}
@media (max-width: 1280px) {
  .search-page .search-books-grid { grid-template-columns: repeat(3, minmax(0, 1fr)); }
}
@media (max-width: 820px) {
  .search-page .search-books-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); }
}
@media (max-width: 520px) {
  .search-page .search-books-grid { grid-template-columns: 1fr; }
}

/* ==== Review-style cards (cover on top, details below) ==== */
.search-page .lib-card.lib-card--review {
  display: block !important;
  height: auto !important;
  min-width: 0 !important;
  grid-template-columns: none !important;
  overflow: visible !important;
}
.search-page .lib-card.lib-card--review .lib-cover {
  position: relative;
  width: 100% !important;
  height: auto !important;
  aspect-ratio: 3 / 4;
  overflow: hidden !important;
  background: #111;
  pointer-events: auto;
  transition: transform 180ms ease, box-shadow 180ms ease, outline-color 180ms ease;
  will-change: transform;
  outline: 0 solid transparent;
}
.search-page .lib-card.lib-card--review .lib-cover img {
  width: 100% !important;
  height: 100% !important;
  object-fit: cover !important;
  display: block !important;
}
@media (hover: hover) and (pointer: fine) {
  .search-page .lib-card .lib-cover:hover {
    transform: translateY(-2px) scale(1.015);
    box-shadow: 0 8px 26px rgba(0,0,0,0.35), 0 2px 8px rgba(0,0,0,0.25);
  }
}

.search-page .lib-card.lib-card--review .lib-details.review-details {
  display: flex !important;
  flex-direction: column !important;
  gap: 8px !important;
  margin-top: 10px !important;
  height: auto !important;
  min-height: 0 !important;
  overflow: visible !important;
}

/* Type scales */
.search-page .lib-card.lib-card--review .lib-title-line {
  font-size: clamp(16px, 1.6vw, 20px) !important;
  font-weight: 800 !important;
  line-height: 1.2 !important;
  white-space: normal !important;
  overflow: hidden !important;
  display: -webkit-box !important;
  -webkit-line-clamp: 2 !important;
  -webkit-box-orient: vertical !important;
}
.search-page .lib-card.lib-card--review .lib-year-line {
  font-size: 13px !important;
  line-height: 1.2 !important;
  opacity: 0.9 !important;
}
.search-page .lib-card.lib-card--review .lib-author-line {
  font-size: 14px !important;
  line-height: 1.3 !important;
  color: rgba(255,255,255,0.8) !important;
}
.search-page .lib-card.lib-card--review .lib-row-actions.is-inline {
  margin-top: 6px !important;
  gap: 8px !important;
}

/* Kill review overlays/dimming on Search cards */
.search-page .lib-card .lib-cover::before,
.search-page .lib-card .lib-cover .review-overlay,
.search-page .lib-card .lib-cover .review-overlay-inner,
.search-page .lib-card.lib-card--review .review-overlay,
.search-page .lib-card.lib-card--review .review-overlay-inner,
.search-page .lib-card.lib-card--review .lib-cover::before {
  display: none !important;
  content: none !important;
  opacity: 0 !important;
  background: transparent !important;
  pointer-events: none !important;
}

/* Neutralize outlines & rings inside cards on Search */
.search-page .lib-card:focus,
.search-page .lib-card:focus-visible,
.search-page .lib-card:active,
.search-page .lib-card *:focus,
.search-page .lib-card *:focus-visible,
.search-page .lib-card *:active,
.search-page a:focus,
.search-page a:focus-visible,
.search-page button:focus,
.search-page button:focus-visible,
.search-page .lib-card:focus-within {
  outline: none !important;
  box-shadow: none !important;
}
.search-page a,
.search-page button,
.search-page .meta-icon-btn { -webkit-tap-highlight-color: transparent; }
.search-page .lib-card,
.search-page .lib-card .lib-cover,
.search-page .lib-card .meta-icon-btn { border-color: transparent !important; }
.search-page .meta-icon-btn:focus,
.search-page .meta-icon-btn:focus-visible,
.search-page .meta-icon-btn:active {
  outline: none !important;
  box-shadow: none !important;
  border-color: transparent !important;
}

/* Ensure cover image isn’t dimmed */
.search-page .lib-card .lib-cover > img:first-child {
  filter: none !important;
  opacity: 1 !important;
}

/* =========================
   HERO (top banner) — final layout & visuals
   ========================= */

/* Hero container uses page gutters (no full-bleed hacks) */
.search-page .lib-hero {
  --hero-h: clamp(64px, 8vw, 88px);
  position: relative !important;
  min-height: var(--hero-h) !important;
  display: flex !important;            /* vertically center inner grid */
  align-items: center !important;
  width: 100% !important;
  max-width: 100% !important;
  margin-left: 0 !important;
  padding-left: var(--pad-x, 28px) !important;
  padding-right: var(--pad-x, 28px) !important;
  overflow: visible !important;
}

/* One-row layout: [ search ][ filter ][ spacer ][ tabs ] */
.search-page .lib-hero > .lib-hero-grid {
  display: grid !important;
  grid-template-columns: auto auto 1fr auto !important; /* search | filter | flex | tabs */
  grid-template-rows: 1fr !important;
  grid-auto-flow: column !important;
  align-items: center !important;
  column-gap: 10px !important;
  width: 100% !important;
  height: 100% !important;
  margin: 0 !important;
  padding: 0 !important; /* gutters live on .lib-hero */
}

/* Search block sits in column 1 */
.search-page .lib-hero-grid .search-identity-slot {
  grid-column: 1 !important;
  justify-self: start !important;
  min-width: 0 !important;
}

/* Filter sits immediately after search in column 2 */
.search-page .lib-hero-grid .lib-hero-cta {
  grid-column: 2 !important;
  display: inline-grid !important;
  place-items: center !important;
  height: var(--search-h, 46px) !important;
  width: calc(var(--search-h, 46px) * 1.3) !important;
  margin: 0 !important;
  padding: 0 !important;
  background: transparent !important;
  border: none !important;
  box-shadow: none !important;
  cursor: pointer !important;
}

/* Tabs cluster hugs the inner right edge (column 4) */
.search-page .lib-hero-grid .lib-tabs {
  grid-column: 4 !important;
  justify-self: end !important;
  display: inline-flex !important;
  flex-wrap: nowrap !important;
  align-items: center !important;
  gap: clamp(10px, 1.6vw, 16px) !important;
  width: max-content !important;
  margin: 0 !important;
  padding: 0 !important;
  overflow: visible !important;
}
.search-page .lib-hero-grid .lib-tabs > .lib-tab {
  display: inline-flex !important;
  flex: 0 0 auto !important;
  white-space: nowrap !important;
  margin: 0 !important;
  transform: none !important;
  box-shadow: none !important;
}

/* Optional nudge for the tabs line on Search only */
body .search-page .lib-hero .lib-hero-grid .lib-tabs {
  transform: translateX(var(--tabs-nudge, -20px)) !important;
}
body .search-page .lib-hero .lib-hero-grid .lib-tabs:hover,
body .search-page .lib-hero .lib-hero-grid .lib-tabs:focus-within {
  transform: translateX(var(--tabs-nudge, -18px)) !important;
}

/* Mobile: search + filter on first row, tabs below right-aligned */
@media (max-width: 720px) {
  .search-page .lib-hero > .lib-hero-grid {
    grid-template-columns: 1fr min-content !important;
    grid-template-rows: auto auto !important;
    grid-auto-rows: auto !important;
    grid-auto-flow: row !important;
    row-gap: 12px !important;
  }
  .search-page .lib-hero-grid .search-identity-slot { grid-column: 1 / 2 !important; }
  .search-page .lib-hero-grid .lib-hero-cta         { grid-column: 2 / 3 !important; justify-self: end !important; }
  .search-page .lib-hero-grid .lib-tabs             { grid-column: 1 / -1 !important; justify-self: end !important; margin-top: 8px; }
}

/* =========================
   Search control visuals — single-outline, split fill (icon | input)
   ========================= */

.search-page .lib-hero {
  --search-h: 46px;
  --outer-bd: 1px solid rgba(255,255,255,0.16);
  --outer-bd-focus: 1px solid rgba(255,255,255,0.28);
  --ring: 0 0 0 2px rgba(255,255,255,0.08);
  --icon-w: 46px;              /* square icon area */
  --icon-bg: #fc5f2e;          /* orange half */
  --input-bg: #0e0e0e;         /* dark half */
  --pad-x: 14px;
  --icon-fs: clamp(34px, 3vw, 42px);
}

/* The single outer rectangle */
.search-page .lib-hero .lib-hero-grid .search-identity-slot > .search-underline {
  display: inline-flex !important;
  align-items: center !important;
  gap: 0 !important;
  height: var(--search-h) !important;
  box-sizing: border-box !important;
  border: var(--outer-bd) !important;
  border-radius: 0 !important;
  background: transparent !important;  /* children paint halves */
  overflow: hidden !important;
  padding: 0 !important;
  margin: 0 !important;
  cursor: text !important;
  width: clamp(260px, 32vw, 560px) !important;
}
.search-page .lib-hero .lib-hero-grid .search-identity-slot > .search-underline:hover {
  border: var(--outer-bd-focus) !important;
}
.search-page .lib-hero .lib-hero-grid .search-identity-slot > .search-underline:focus-within {
  border: var(--outer-bd-focus) !important;
  box-shadow: var(--ring) !important;
}

/* LEFT half — icon area */
.search-page .search-underline .search-icon {
  width: var(--icon-w) !important;
  height: var(--search-h) !important;
  display: inline-flex !important;
  align-items: center !important;
  justify-content: center !important;
  background: var(--icon-bg) !important;
  color: #fff !important;
  line-height: 1 !important;
  font-size: var(--icon-fs) !important;
  transform: translateY(1px) !important; /* your 1px nudge */
  border: 0 !important;
  box-shadow: none !important;
  margin: 0 !important;
  padding: 0 !important;
}

/* RIGHT half — input area */
.search-page .search-underline .search-input-underline {
  flex: 1 1 auto !important;
  min-width: 200px !important;
  height: var(--search-h) !important;
  background: var(--input-bg) !important;
  color: #fff !important;
  -webkit-text-fill-color: #fff !important;
  border: 0 !important;
  outline: none !important;
  box-shadow: none !important;
  padding: 0 var(--pad-x) !important;
  margin: 0 !important;
  line-height: 1.2 !important;
  box-sizing: border-box !important;

  /* typography (placeholder == typed) */
  --search-fs: clamp(18px, calc(var(--tab-h) * 0.46), 22px);
  font-weight: 800 !important;
  font-size: var(--search-fs) !important;
}
.search-page .search-underline .search-input-underline::placeholder {
  font-weight: 800;
  font-size: var(--search-fs);
  color: rgba(255,255,255,0.65);
}

/* Inner padding so text doesn’t touch edges */
.search-page .search-underline .search-input-underline {
  --pad-l: 16px;  --pad-r: 16px;
  padding: 0 var(--pad-r) 0 var(--pad-l) !important;
}
body .search-page .lib-hero .lib-hero-grid .search-identity-slot > .search-underline .search-input-underline {
  box-sizing: border-box !important;
  width: 100% !important;
  padding-left: 16px !important;
  padding-right: 16px !important;
  text-indent: 0 !important;
}
body .search-page .lib-hero .lib-hero-grid .search-identity-slot > .search-underline .search-input-underline::placeholder {
  text-indent: 0 !important;
}

/* Filter icon sizing/alignment */
.search-page .lib-hero-cta .material-symbols-outlined {
  font-size: 40px !important;
  line-height: 1 !important;
  transform: none !important;
  color: #fff !important;
}
.search-page .lib-hero-cta .lib-cta--icon:hover {
  filter: brightness(1.2);
  transform: scale(1.03);
}

/* Keep row alignment tidy */
.search-page .search-underline { 
  display: inline-flex !important;
  align-items: center !important;
  gap: 10px !important;
}
.search-page .lib-hero-grid {
  align-items: center !important;
  column-gap: 14px !important; /* small comfy spacing overall */
}

/* Mobile width for the field */
@media (max-width: 720px){
  .search-page .search-underline { width: min(88vw, 560px); }
}

/* === Search left alignment: 28px gutter & no extra offsets ========== */
.search-page .lib-hero {
  padding-left: 28px !important;   /* left gutter to match AppHeader */
}

.search-page .lib-hero > .lib-hero-grid {
  padding: 0 !important;           /* gutters live on .lib-hero */
  margin: 0 !important;
}

.search-page .lib-hero-grid .search-identity-slot {
  grid-column: 1 !important;
  justify-self: start !important;  /* hug the hero's inner left edge */
  margin: 0 !important;
  padding: 0 !important;
}

.search-page .lib-hero-grid .search-identity-slot > .search-underline {
  margin: 0 !important;            /* kill any leftover left nudges */
  transform: none !important;      /* cancel old translate hacks */
}

/* === Filter: align to search (dead-center, no offsets) ================= */
.search-page .lib-hero > .lib-hero-grid {
  grid-template-columns: auto auto 1fr auto !important; /* search | filter | spacer | tabs */
  column-gap: 10px !important;                           /* tidy gap between search & filter */
}

.search-page .lib-hero-grid .lib-hero-cta {
  grid-column: 2 !important;           /* sits right after the search */
  justify-self: start !important;      /* hug the search horizontally */
  align-self: center !important;       /* vertical center in the hero row */
  position: static !important;         /* kill absolute/fixed leftovers */
  margin: 0 !important;
  padding: 0 !important;
  transform: none !important;          /* kill translate nudges */
}

/* Make the button a clean, centered square matching the search height */
.search-page .lib-hero-cta .lib-filter-btn,
.search-page .lib-hero-cta .lib-cta--icon {
  display: inline-grid !important;
  place-items: center !important;      /* center horizontally & vertically */
  height: var(--search-h, 46px) !important;
  width: calc(var(--search-h, 46px) * 1.1) !important;  /* comfy hit area */
  padding: 0 !important;
  margin: 0 !important;
  background: transparent !important;
  border: 0 !important;
  box-shadow: none !important;
  transform: none !important;
}

/* Icon inside: no vertical nudge, same size system as search icon */
.search-page .lib-hero-cta .material-symbols-outlined {
  font-size: var(--icon-fs, clamp(34px, 3vw, 42px)) !important;
  line-height: 1 !important;
  transform: none !important;          /* kill translateY tweaks */
  color: #fff !important;
}

/* Safety: keep the search block tight to the left gutter (28px already set) */
.search-page .lib-hero-grid .search-identity-slot > .search-underline {
  margin: 0 !important;
  transform: none !important;
}

/* === Restore visible caret in the Search input ======================= */
.search-page input.search-input-underline {
  /* make sure it's focusable & visible */
  display: inline-block !important;
  opacity: 1 !important;
  visibility: visible !important;
  pointer-events: auto !important;

  /* text + caret */
  color: #fff !important;
  -webkit-text-fill-color: #fff !important;  /* WebKit */
  caret-color: #fff !important;              /* the blinking caret */
}

/* keep the caret white on focus */
.search-page input.search-input-underline:focus,
.search-page input.search-input-underline:focus-visible {
  caret-color: #fff !important;
}

/* iOS/WebKit quirk: transforms on ancestors can hide the caret.
   Nuke any leftover transforms/filters in the search cluster. */
.search-page .lib-hero-grid .search-identity-slot,
.search-page .lib-hero-grid .search-identity-slot *,
.search-page .search-underline,
.search-page .search-underline * {
  transform: none !important;
  filter: none !important;
}

/* === Filter popover: align to the filter button (top-right under it) === */
.search-page .lib-hero-grid .lib-hero-cta {
  position: relative !important;     /* anchor for the popover */
  overflow: visible !important;       /* allow the popover to show outside */
}

.search-page .lib-filter-menu {
  position: absolute !important;
  top: calc(100% + 8px) !important;   /* 8px gap below the button */
  right: 0 !important;                /* align popover's right edge to button */
  left: auto !important;
  bottom: auto !important;

  transform: none !important;         /* kill stray transforms */
  margin: 0 !important;
  z-index: 3000 !important;           /* above header/cards */
}

/* Optional: keep it sane on narrow screens */
@media (max-width: 720px) {
  .search-page .lib-filter-menu {
    max-width: 92vw !important;
    right: 0 !important;
    left: auto !important;
  }
}

/* === Minimal text-only style for the three right buttons ============ */
.search-page .lib-hero-grid .lib-tabs .lib-tab {
  background: transparent !important;
  border: none !important;
  box-shadow: none !important;
  color: #fff !important;
  font-weight: 800 !important;
  font-size: clamp(14px, calc(var(--tab-h) * 0.34), 18px) !important;
  text-transform: none !important;
  letter-spacing: normal !important;
  line-height: 1 !important;
  padding: 0 !important;
  margin: 0 !important;
  cursor: pointer !important;
  transition: color 0.2s ease;
}

/* Hover/focus feedback (subtle) */
.search-page .lib-hero-grid .lib-tabs .lib-tab:hover,
.search-page .lib-hero-grid .lib-tabs .lib-tab:focus-visible {
  color: rgba(255,255,255,0.7) !important;
  transform: none !important;
  box-shadow: none !important;
}

/* Remove any active background highlight */
.search-page .lib-hero-grid .lib-tabs .lib-tab.is-active {
  background: transparent !important;
  color: #fff !important;
  border: none !important;
}
