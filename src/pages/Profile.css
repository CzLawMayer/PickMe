/* ===== App frame ===== */
.profile-app {
  height: 100svh;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}
.profile-app .header { flex: 0 0 auto; }
.profile-page {
  flex: 1 1 auto;
  min-height: 0;
  overflow: hidden;
  padding: clamp(12px, 2vw, 24px);
  box-sizing: border-box;
}

/* Only the profile page gets a black header */
.header { background: transparent; }
.profile-app > .header { background-color: #000; }

/* ===== Global grid (3 columns Ã— 3 rows) ===== */
.profile-grid {
  height: 100%;
  display: grid;
  grid-template-columns: minmax(0, 1fr) fit-content(clamp(260px, 36vw, 360px)) minmax(0, 1fr);
  grid-template-rows: auto 1fr auto !important; /* final layout */
  gap: clamp(16px, 2vw, 28px);
}

/* Place cells */
.identity-cell  { grid-column: 1; grid-row: 1; align-self: start; }
.stories-cell   { grid-column: 1; grid-row: 2; align-self: stretch; }
.favorites-cell { grid-column: 1; grid-row: 3; align-self: end; }

.feature-cell   { grid-column: 2; grid-row: 1 / 4; align-self: stretch; }

.library-cell   { grid-column: 3; grid-row: 1 / 3; align-self: stretch; }
.current-cell   { grid-column: 3; grid-row: 3; align-self: end; }

/* Generic cell wrapper */
.cell { min-width: 0; min-height: 0; overflow: hidden; }

/* ===== Titles ===== */
.section { container-type: inline-size; display: flex; flex-direction: column; min-height: 0; }
.section-title { margin: 0 0 10px; font-size: clamp(0.9rem, 5cqw, 1.6rem); line-height: 1.1; font-weight: 600; }

/* ===== Identity block ===== */
.profile-card { display: flex; align-items: center; gap: 18px; min-width: 0; }
.profile-avatar { width: 96px; height: 96px; display: inline-flex; align-items: center; justify-content: center; }
.profile-avatar svg { width: 96px; height: 96px; }

.profile-id {
  display: grid;
  grid-auto-rows: max-content;
  flex: 1 1 auto;
  min-width: 0;
  container-type: inline-size;
  justify-items: start;
  text-align: left;
  color: #fff;
}
.profile-id .profile-name {
  margin: 0 0 2px;
  font-weight: 800;
  font-size: clamp(1rem, 8cqw, 2.4rem);
  line-height: 1.24;
  padding-bottom: 0.18em;
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.profile-id .profile-handle {
  margin: 0 0 8px;
  opacity: 0.8;
  font-weight: 600;
  line-height: 1.1;
  font-size: clamp(0.9rem, 5cqw, 1.6rem);
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.profile-id .profile-handle { margin-top: -0.22em; } /* visual compensation */

/* Left-aligned 75% color bars */
.profile-bars {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  height: 8px;
  gap: 0;
  width: 75%;
  margin: 0;
  justify-self: start;
  align-self: start;
}
.profile-bars .bar { width: 100%; height: 100%; }
.bar-1 { background: #de5a43; }
.bar-2 { background: #d006c1; }
.bar-3 { background: #6c2ea8; }
.bar-4 { background: #1e90ff; }

/* ===== Black strips ===== */
.strip { background: #000; border: none; }
.section .strip { flex: 0 0 auto !important; } /* strips size to content */

/* ===== Center feature card ===== */
.feature-card {
  background: #000; border: none; width: auto; justify-self: center; height: 100%;
  display: flex; align-items: center; justify-content: center;
  padding: clamp(12px, 1.6vw, 16px); box-sizing: border-box; text-align: center; overflow: visible;
}
.feature-stack { display: flex; flex-direction: column; align-items: center; gap: clamp(10px, 2vh, 14px); min-width: 0; max-height: 100%; }

:root { --fit-w: min(clamp(130px, 24vh, 260px), 42vw); }
.feature-card .feature-stack { width: var(--fit-w); max-width: 100%; padding-left: calc(var(--fit-w) * 0.25); padding-right: calc(var(--fit-w) * 0.25); box-sizing: content-box; margin: 0 auto; }
.feature-cover-placeholder { width: var(--fit-w); aspect-ratio: 12 / 17; background: #1b1b1b; border: none; }

.feature-info { width: 100%; max-width: var(--fit-w); margin: 0 auto; text-align: center; overflow: hidden; container-type: inline-size; }
.feature-title { margin: 0 0 10px; font-weight: 900; line-height: 1.1; font-size: clamp(1.25rem, 6.2cqw, 2.2rem); }

.meta-hr { border: 0; height: 1px; background: rgba(255,255,255,0.12); margin: clamp(6px, 1vh, 8px) 0; }

.feature-author { display: flex; align-items: center; justify-content: center; gap: 8px; min-height: 28px; }
.meta-avatar--sm { width: 26px; height: 26px; display: inline-flex; align-items: center; justify-content: center; }
.meta-avatar--sm svg { width: 26px; height: 26px; }
.feature-author-name { font-weight: 600; font-size: clamp(0.95rem, 4.2cqw, 1.25rem); }

.feature-info .meta-chapters { font-size: clamp(0.95rem, 4.2cqw, 1.25rem); line-height: 1.2; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin: 0; }
.align-left { text-align: left; margin: 0 auto; max-width: var(--fit-w); font-size: clamp(0.78rem, 1.35vh, 0.95rem); line-height: 1.25; }

.feature-info,
.feature-title,
.feature-author-name,
.align-left,
.align-left * { overflow-wrap: anywhere; word-break: break-word; hyphens: auto; }

/* Actions */
.meta-actions {
  width: 100%; max-width: var(--fit-w);
  display: grid; grid-template-columns: repeat(3, 1fr); gap: 0;
  align-items: center; justify-content: normal;
  padding-block: 6px; margin: 0; container-type: inline-size; overflow: visible;
}
.meta-actions .meta-icon-btn {
  display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 6px;
  width: 100%; min-width: 0; padding: 0; margin: 0; border: 0; background: transparent; box-shadow: none;
}
.meta-actions .meta-icon-glyph { font-size: clamp(52px, 12cqw, 96px); line-height: 1; }
.meta-actions .meta-icon-btn svg { height: clamp(48px, 11cqw, 92px); width: auto; }
.meta-actions .meta-icon-count { white-space: nowrap; text-align: center; line-height: 1.1; font-size: clamp(0.78rem, 3.2cqw, 1rem); font-variant-numeric: tabular-nums; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
.meta-actions .meta-icon-btn.star { position: relative; }
.meta-actions .meta-icon-btn.star .star-popover {
  position: absolute; bottom: calc(100% + 8px); left: 50%; transform: translateX(-50%);
  z-index: 5; background: #111; border: 1px solid rgba(255,255,255,0.12); border-radius: 10px;
  padding: 8px 10px; box-shadow: 0 8px 22px rgba(0,0,0,0.35); min-width: 180px;
}
.meta-actions .meta-icon-btn.star .star-popover * { pointer-events: auto; }

/* ===== Genres ===== */
.feature-info .meta-tags { display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 8px 10px; padding: 0; margin: 0; list-style: none; text-align: center; }
.feature-info .meta-tags li {
  display: inline-flex; align-items: center; padding: 6px 12px; border-radius: 999px; line-height: 1;
  white-space: nowrap; font-weight: 600; font-size: clamp(0.85rem, 3.2cqw, 1.05rem);
  transition: transform 120ms ease, box-shadow 120ms ease, filter 120ms ease;
}
.feature-info .meta-tags li:active { transform: translateY(1px); }
.feature-info .meta-tags.meta-tags--outline li { color: #fff; background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.22); box-shadow: inset 0 0 0 0 rgba(255,255,255,0); }
.feature-info .meta-tags.meta-tags--outline li:hover { border-color: rgba(255,255,255,0.36); background: rgba(255,255,255,0.10); }
.feature-info .meta-tags li::before,
.feature-info .meta-tags li::after { content: none !important; }

/* ===== Library (fills remainder on the right) ===== */
.right-title { display: flex; align-items: baseline; gap: 6px; }
.library-cell { display: flex; flex-direction: column; min-height: 0; }
.shelf {
  background: #4b2419; padding: 20px; border: 1px solid rgba(0,0,0,0.2); border-radius: 0;
  flex: 1 1 auto; display: flex; flex-direction: column; gap: 20px; min-height: 0;
}
.shelf-row { background: #111; flex: 1; border-radius: 0; }

/* ===== Favorites & Currently Reading (bottom-aligned) ===== */
.favorites-cell.section,
.current-cell.section { display: flex; flex-direction: column; min-height: 0; }

.favorites-strip,
.current-strip {
  display: block !important;
  padding: clamp(10px, 1.6vw, 16px) !important;
  box-sizing: border-box;
  background: #000;
}
.favorites-strip .favorites-grid,
.current-strip  .current-grid {
  display: grid !important;
  grid-template-columns: repeat(5, minmax(0, 1fr)) !important;
  gap: clamp(8px, 1.6vw, 16px) !important;
  justify-items: center !important;
  align-items: center !important;
  margin: 0 !important;
  padding: 0 !important;
}
.fav-cover,
.cur-cover {
  width: 100% !important; max-width: none !important; aspect-ratio: 12 / 17 !important; height: auto !important;
  background: #1b1b1b; border: none;
}

/* ===== Stories (smooth scroll + custom pill; pill only when scrollable) ===== */
.stories-cell.section { display: flex; flex-direction: column; min-height: 0; }
.stories-cell .section-title { margin-bottom: 8px; }
.stories-strip {
  display: grid !important;
  grid-template-rows: max-content max-content;
  align-content: center;
  justify-items: stretch;
  gap: 8px;
  padding: clamp(8px, 1.2vw, 12px);
  background: #000;
  box-sizing: border-box;
  min-height: 0;
}
.stories-viewport {
  overflow-x: auto !important; overflow-y: hidden !important;
  scroll-behavior: auto !important; scroll-snap-type: none !important;
  scrollbar-width: none; min-height: 0;
}
.stories-viewport::-webkit-scrollbar { display: none; }
.stories-track { display: flex !important; gap: clamp(8px, 1.6vw, 16px) !important; align-items: center !important; }
.story-cover {
  flex: 0 0 calc((100% - (4 * clamp(8px, 1.6vw, 16px))) / 5) !important;
  aspect-ratio: 12 / 17 !important; height: auto !important; background: #1b1b1b; border: none;
}
.stories-progress {
  position: static !important; width: 100%; height: 8px; border-radius: 9999px;
  background: transparent !important; margin: 2px 0 0 0; touch-action: none; cursor: pointer;
}
.stories-thumb {
  position: relative; display: block; height: 100%; border-radius: 9999px;
  background: #fff; box-shadow: 0 0 0 2px #000;
}

/* ===== Responsive tweaks ===== */
@media (max-width: 900px) {
  .profile-grid {
    grid-template-columns: minmax(0, 1fr) fit-content(clamp(220px, 42vw, 320px)) minmax(0, 1fr);
    gap: 12px;
  }
}
@media (max-width: 560px), (max-height: 680px) {
  .meta-actions .meta-icon-glyph { font-size: clamp(26px, 8cqw, 38px); }
  .meta-actions .meta-icon-count { font-size: clamp(0.7rem, 3cqw, 0.9rem); }
}

/* Large-screen spacing tuning */
@media (min-width: 1200px) and (min-height: 850px) {
  .identity-cell { align-self: stretch; }
  .profile-identity { display: flex; flex-direction: column; justify-content: center; padding-block: clamp(8px, 3vh, 36px); }
  .profile-avatar, .profile-avatar svg { width: clamp(96px, 12vh, 148px); height: clamp(96px, 12vh, 148px); }
  .profile-id { row-gap: clamp(4px, 1.4vh, 18px); }
  .profile-id .profile-name { line-height: 1.2; }
  .profile-id .profile-handle { line-height: 1.25; }
  .stories-cell { align-self: stretch; }
  .stories-strip { align-content: end !important; }
  .favorites-strip, .current-strip { padding-block: clamp(8px, 1.4vh, 16px) !important; }
}
@media (min-width: 1024px) and (min-height: 760px) {
  .stories-strip { align-content: end !important; }
}

/* ===== Accessibility / focus tweaks ===== */
*:focus { outline: none !important; caret-color: transparent !important; }
button:focus,
input[type="range"]:focus,
[tabindex]:focus,
a:focus,
.story-cover:focus,
.fav-cover:focus,
.cur-cover:focus { outline: none !important; box-shadow: none !important; }

.story-cover,
.fav-cover,
.cur-cover,
.feature-card,
.section,
.header,
.profile-grid { user-select: none; }

.stories-viewport,
.favorites-strip,
.current-strip { caret-color: transparent !important; }

:focus-visible { outline: 2px solid rgba(255, 255, 255, 0.4); outline-offset: 2px; }


/* ===== Genre tag coloring (rotating soft hues) ===== */
.feature-info .meta-tags.meta-tags--outline li {
  color: #fff;
  border: 1px solid rgba(255,255,255,0.22);
  background: hsla(var(--chip-h, 0), 75%, 60%, 0.14);
  border-color: hsla(var(--chip-h, 0), 75%, 60%, 0.35);
  transition: background 120ms ease, border-color 120ms ease;
}

/* pleasant rotating hues (very soft tint) */
.feature-info .meta-tags.meta-tags--outline li:nth-child(6n+1){ --chip-h: 210; } /* blue */
.feature-info .meta-tags.meta-tags--outline li:nth-child(6n+2){ --chip-h: 12;  } /* orange */
.feature-info .meta-tags.meta-tags--outline li:nth-child(6n+3){ --chip-h: 280; } /* purple */
.feature-info .meta-tags.meta-tags--outline li:nth-child(6n+4){ --chip-h: 140; } /* green */
.feature-info .meta-tags.meta-tags--outline li:nth-child(6n+5){ --chip-h: 320; } /* magenta */
.feature-info .meta-tags.meta-tags--outline li:nth-child(6n+6){ --chip-h: 40;  } /* amber */

.feature-info .meta-tags.meta-tags--outline li:hover {
  background: hsla(var(--chip-h, 0), 75%, 60%, 0.22) !important;
  border-color: hsla(var(--chip-h, 0), 75%, 60%, 0.46) !important;
  filter: none !important;
  -webkit-filter: none !important;
}

.profile-bars .bar-1 { background: #fc5f2e; } /* orange */
.profile-bars .bar-2 { background: #d81b60; } /* pink */
.profile-bars .bar-3 { background: #6a1b9a; } /* purple */
.profile-bars .bar-4 { background: #1e88e5; } /* blue */