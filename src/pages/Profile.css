/* ===== App frame: full height, static ===== */
.profile-app {
  height: 100svh;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}
.profile-app .header { flex: 0 0 auto; }
.profile-page {
  flex: 1 1 auto;
  min-height: 0;
  overflow: hidden;                  /* no page scroll */
  padding: clamp(12px, 2vw, 24px);   /* page margin */
  box-sizing: border-box;
}

.header {
  background-color: #000;
}

/* ===== Global grid (3 columns × 3 rows) ===== */
.profile-grid {
  height: 100%;
  display: grid;
  /* Middle track can be up to 36vw/360px, but shrinks to content (book+25% sides) */
  grid-template-columns: minmax(0, 1fr) fit-content(clamp(260px, 36vw, 360px)) minmax(0, 1fr);
  grid-template-rows: auto 1fr 1fr;  /* Row1=top, Row2=middle, Row3=bottom */
  gap: clamp(16px, 2vw, 28px);
}

/* Place cells */
.identity-cell { grid-column: 1; grid-row: 1; }
.stories-cell  { grid-column: 1; grid-row: 2; }
.favorites-cell{ grid-column: 1; grid-row: 3; }

.feature-cell  { grid-column: 2; grid-row: 1 / 4; } /* span all rows */

.library-cell  { grid-column: 3; grid-row: 1 / 3; } /* spans rows 1–2 */
.current-cell  { grid-column: 3; grid-row: 3; }

/* Generic cell wrapper */
.cell { min-width: 0; min-height: 0; overflow: hidden; }

/* ===== Titles ===== */
.section-title {
  margin: 0 0 10px;
  font-size: clamp(1rem, 1.3vw, 1.5rem);
  font-weight: 700;
}

/* ===== Left: identity block ===== */
.profile-card { display: flex; align-items: center; gap: 18px; }
.profile-avatar { width: 96px; height: 96px; display: inline-flex; align-items: center; justify-content: center; }
.profile-avatar svg { width: 96px; height: 96px; }
.profile-id .profile-name { margin: 0 0 2px; }
.profile-id .profile-handle { margin: 0 0 8px; opacity: 0.75; }

/* Single row of 4 tight color bars (no gaps) */
.profile-bars { display: grid; grid-template-columns: repeat(4, 1fr); height: 8px; gap: 0; }
.profile-bars .bar { width: 100%; height: 100%; }
.bar-1 { background: #de5a43; }
.bar-2 { background: #d006c1; }
.bar-3 { background: #6c2ea8; }
.bar-4 { background: #1e90ff; }

/* ===== Section wrapper (title + content that stretches) ===== */
.section { display: flex; flex-direction: column; min-height: 0; }
.section .strip { flex: 1 1 auto; min-height: 0; }

/* Black strips fill their grid row */
.strip { background: #000; border: none; }

/* ===== Center feature card ===== */
.feature-card {
  background: #000;
  border: none;
  width: auto;                 /* let the middle track shrink to content */
  justify-self: center;        /* keep centered in the middle column */
  height: 100%;
  display: flex;
  align-items: center;         /* horizontal center */
  justify-content: center;     /* vertical center */
  padding: clamp(12px, 1.6vw, 16px);
  box-sizing: border-box;
  text-align: center;
  overflow: visible;           /* allow star popover */
}
.feature-stack {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: clamp(10px, 2vh, 14px); /* a touch larger gap above title */
  min-width: 0;
  max-height: 100%;
}

/* Book + metadata share width token; add 25% book width on each side */
:root { --fit-w: min(clamp(130px, 24vh, 260px), 42vw); } /* slightly bigger default */
.feature-card .feature-stack {
  width: var(--fit-w);
  max-width: 100%;
  padding-left: calc(var(--fit-w) * 0.25);
  padding-right: calc(var(--fit-w) * 0.25);
  box-sizing: content-box;   /* padding becomes visual side space */
  margin: 0 auto;
}

.feature-cover-placeholder {
  width: var(--fit-w);
  aspect-ratio: 12 / 17;
  background: #1b1b1b;
  border: none;
}

/* Metadata */
.feature-info {
  width: 100%;
  max-width: var(--fit-w);
  margin: 0 auto;
  text-align: center;
  overflow: hidden;
  container-type: inline-size; /* enables cqw scaling below */
}
.feature-title {
  margin: 0 0 6px;
  font-size: clamp(0.9rem, 1.6vh, 1.15rem);
  font-weight: 800;
}

/* subtle separators */
.meta-hr {
  border: 0; height: 1px;
  background: rgba(255,255,255,0.12);
  margin: clamp(6px, 1vh, 8px) 0;
}

/* Author row */
.feature-author {
  display: flex; align-items: center; justify-content: center;
  gap: 8px; min-height: 28px;
}
.meta-avatar--sm { width: 26px; height: 26px; display: inline-flex; align-items: center; justify-content: center; }
.meta-avatar--sm svg { width: 26px; height: 26px; }
.feature-author-name { font-weight: 600; font-size: clamp(0.85rem, 1.4vh, 1rem); }

/* ===== Actions row — 3 equal columns, edge-to-edge, big icons ===== */
.meta-actions {
  width: 100%;
  max-width: var(--fit-w);
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 0;
  align-items: center;
  justify-content: normal;
  padding: 0;
  margin: 0;
  container-type: inline-size; /* cqw for icon/count scaling */
  overflow: visible; /* popover */
}
.meta-actions .meta-icon-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  min-width: 0;
  width: 100%;
  padding: 0;
  margin: 0;
  border: 0;
  background: transparent;
  box-shadow: none;
}
.meta-actions .meta-icon-btn:first-child { justify-content: flex-start; } /* heart → left */
.meta-actions .meta-icon-btn:last-child  { justify-content: flex-end;   } /* save  → right */

.meta-actions .meta-icon-glyph { font-size: clamp(28px, 7.5cqw, 44px); line-height: 1; }
.meta-actions .meta-icon-count {
  white-space: nowrap;
  line-height: 1.1;
  margin-left: clamp(6px, 1cqw, 10px);
  font-size: clamp(0.78rem, 3.4cqw, 1rem);
}

/* Keep counts on smaller screens if possible */
@media (max-width: 560px), (max-height: 680px) {
  .meta-actions .meta-icon-glyph { font-size: clamp(26px, 8cqw, 38px); }
  .meta-actions .meta-icon-count { font-size: clamp(0.7rem, 3cqw, 0.9rem); margin-left: clamp(4px, 0.8cqw, 8px); }
}

/* Star popover positioning (relative to the star button) */
.meta-actions .meta-icon-btn.star { position: relative; }
.meta-actions .meta-icon-btn.star .star-popover {
  position: absolute;
  bottom: calc(100% + 8px);
  left: 50%;
  transform: translateX(-50%);
  z-index: 5;
  background: #111;
  border: 1px solid rgba(255,255,255,0.12);
  border-radius: 10px;
  padding: 8px 10px;
  box-shadow: 0 8px 22px rgba(0,0,0,0.35);
  min-width: 180px;
}
.meta-actions .meta-icon-btn.star .star-popover * { pointer-events: auto; }

/* Left-aligned sub-blocks inside centered column */
.align-left {
  text-align: left;
  margin: 0 auto;
  max-width: var(--fit-w);
  font-size: clamp(0.78rem, 1.35vh, 0.95rem);
  line-height: 1.25;
}
.feature-info,
.feature-title,
.feature-author-name,
.align-left,
.align-left * { overflow-wrap: anywhere; word-break: break-word; hyphens: auto; }

/* Keep “Chapters” as one line; scale with container width */
.feature-info .meta-chapters {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: clip;
  font-size: clamp(0.72rem, 3.2cqw, 0.95rem);
  line-height: 1.2;
  margin: 0;
}
.feature-info .meta-chapters > span { display: inline-block; max-width: 100%; transform-origin: left center; }

/* Genres vertical, always visible (no max-height to hide items) */
.feature-info .meta-tags { padding: 0; margin: 0; }
.feature-info .meta-tags li { list-style: none; max-width: 100%; overflow: hidden; text-overflow: ellipsis; }
.vertical-tags { display: flex; flex-direction: column; align-items: flex-start; gap: clamp(4px, 0.8vh, 6px); }

/* ===== Right: library ===== */
.right-title { display: flex; align-items: baseline; gap: 6px; }
.library-cell { display: flex; flex-direction: column; min-height: 0; }
.shelf {
  background: #4b2419;
  padding: 20px;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 0;
  flex: 1 1 auto;             /* fill the rest of the (row1–2) area */
  display: flex;
  flex-direction: column;
  gap: 20px;
  min-height: 0;
}
.shelf-row {
  background: #111;
  flex: 1;
  border-radius: 0;
}

/* ===== Size tokens (library height) ===== */
.profile-app { --shelf-h: clamp(360px, 52vh, 600px); }

/* Width tweaks: keep center rail reasonable on small screens */
@media (max-width: 900px) {
  .profile-grid {
    grid-template-columns: minmax(0, 1fr) fit-content(clamp(220px, 42vw, 320px)) minmax(0, 1fr);
    gap: 12px;
  }
}

/* Center icon + count in each column */
.meta-actions {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  align-items: center;
}

.meta-actions .meta-icon-btn {
  display: flex;
  flex-direction: column;      /* icon on top, number below */
  align-items: center;         /* center horizontally */
  justify-content: center;     /* center vertically within the cell */
  gap: 6px;
  width: 100%;
  min-width: 0;
}

.meta-actions .meta-icon-glyph { line-height: 1; }

/* Number styling */
.meta-actions .meta-icon-count {
  margin-left: 0;              /* no side offset */
  text-align: center;
  line-height: 1.1;
  font-variant-numeric: tabular-nums;  /* keeps digits lined up */
}

/* Remove the left/right justification overrides (they shift centering) */
.meta-actions .meta-icon-btn:first-child { justify-content: center; }
.meta-actions .meta-icon-btn:last-child  { justify-content: center; }

/* Let the identity block be a container for cqw sizing */
.profile-id { container-type: inline-size; }

/* Name uses as much space as possible without blowing layout */
.profile-id .profile-name {
  margin: 0 0 2px;
  font-weight: 800;
  line-height: 1.05;
  /* Scale with container width; clamp to sensible min/max */
  font-size: clamp(1rem, 8cqw, 2.4rem);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Handle slightly smaller but still responsive */
.profile-id .profile-handle {
  margin: 0 0 8px;
  opacity: 0.8;
  font-weight: 600;
  line-height: 1.1;
  font-size: clamp(0.9rem, 5cqw, 1.6rem);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Make the color bars take 75% of the identity row width and sit flush right */
.profile-bars {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  height: 8px;
  gap: 0;
  width: 75%;
  margin-left: auto;   /* pushes the bars to the right edge */
}

/* bars already fill 100% of the .profile-bars width */
.profile-bars .bar { width: 100%; height: 100%; }

.meta-actions .meta-icon-count {
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* Ensure the right side of the identity row can grow and has measurable width */
.profile-card { 
  display: flex; 
  align-items: center; 
  gap: 18px; 
  min-width: 0;              /* <-- allow shrinking inside grid cell */
}
.profile-id { 
  flex: 1 1 auto;            /* <-- take remaining space next to avatar */
  min-width: 0;              /* <-- critical to avoid zero-width clipping */
  container-type: inline-size; 
}

/* Make sure the identity text is visible on dark backgrounds */
.identity-cell, 
.profile-identity, 
.profile-id {
  color: #fff;               /* set text color explicitly */
}

/* Keep the “fill the space” sizing for name/handle */
.profile-id .profile-name {
  margin: 0 0 2px;
  font-weight: 800;
  line-height: 1.05;
  font-size: clamp(1rem, 8cqw, 2.4rem);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.profile-id .profile-handle {
  margin: 0 0 8px;
  opacity: 0.8;
  font-weight: 600;
  line-height: 1.1;
  font-size: clamp(0.9rem, 5cqw, 1.6rem);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Right-aligned colored bars using 75% of the available inline size */
.profile-bars {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  height: 8px;
  gap: 0;
  width: 75%;
  margin-left: auto;         /* pushes the bars to the right edge */
}

/* Left-align the colored bar under the identity text */
.profile-bars {
  width: 75%;
  margin-left: 0;     /* was auto */
  margin-right: auto; /* keep it flush to the left */
}

/* Make the identity grid default to left-aligned items */
.profile-id {
  justify-items: start;   /* grid children align to the left */
}

/* Pin the color bars to the left and keep them at 75% width */
.profile-bars {
  width: 75%;
  margin: 0;              /* reset any previous auto margins */
  justify-self: start;    /* left edge of the profile-id grid */
  align-self: start;
  place-self: start;      /* shorthand; safe if supported */
  display: grid;          /* keep your 4-column bar grid */
  grid-template-columns: repeat(4, 1fr);
}

/* If something upstream set centering via logical margins, nuke it */
.profile-bars {
  margin-inline: 0;
}

/* ==== FORCE COLORED BAR TO LEFT UNDER NAME ==== */
.identity-cell .profile-id {
  justify-items: start;              /* grid children default left */
  text-align: left;
}

.identity-cell .profile-id .profile-bars {
  width: 75%;
  margin: 0 !important;              /* kill any margin-left:auto */
  margin-right: auto !important;     /* anchor left edge */
  justify-self: start !important;    /* left within the grid cell */
  align-self: start !important;
}
