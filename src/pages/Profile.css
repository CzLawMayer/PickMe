/* Fill viewport; no scroll, truly static */
.profile-app {
  height: 100svh;            /* was min-height */
  overflow: hidden;          /* belt & suspenders */
  display: flex;
  flex-direction: column;
}
.profile-app .header { flex: 0 0 auto; }
.profile-page {
  flex: 1 1 auto;
  min-height: 0;
  overflow: hidden;                 /* keep static */
  padding: clamp(12px, 2vw, 24px);  /* page margins */
  box-sizing: border-box;
}

/* 3-column grid; center “middle ground” */
.profile-grid {
  height: 100%;
  display: grid;
  grid-template-columns: minmax(0, 1fr) clamp(260px, 36vw, 360px) minmax(0, 1fr);
  gap: clamp(16px, 2vw, 28px);
  align-items: stretch;
  align-content: stretch;
}

/* Columns behave as vertical flex rails that fill available height */
.profile-left,
.profile-right,
.profile-center {
  display: flex;
  flex-direction: column;
  min-width: 0;
  min-height: 100%;
  overflow: hidden;
}

/* Titles */
.section-title {
  margin: 18px 0 10px;
  font-size: clamp(1rem, 1.3vw, 1.5rem);
  font-weight: 700;
}
.profile-left .section-title:first-of-type,
.profile-right .right-title {
  margin-top: 0; /* snap top */
}

/* LEFT column */
.profile-card { display: flex; align-items: center; gap: 18px; margin-bottom: 18px; }
.profile-avatar { width: 96px; height: 96px; display: inline-flex; align-items: center; justify-content: center; }
.profile-avatar svg { width: 96px; height: 96px; }
.profile-id .profile-name { margin: 0 0 2px; }
.profile-id .profile-handle { margin: 0 0 8px; opacity: 0.75; }

.profile-bars { display: flex; gap: 8px; height: 8px; }
.profile-bars .bar { height: 100%; width: 56px; background: #2f2f2f; }
.profile-bars .bar-1 { background: #de5a43; }
.profile-bars .bar-2 { background: #d006c1; }
.profile-bars .bar-3 { background: #6c2ea8; }
.profile-bars .bar-4 { background: #1e90ff; }

/* Black strips */
.strip { background: #000; border: none; height: var(--strip-h); }
.stories-strip, .favorites-strip, .current-strip { height: var(--strip-h); }

/* Push last strip on each side to the bottom padding */
.profile-left .favorites-section { margin-top: auto; }
.profile-right .current-section  { margin-top: auto; }

/* CENTER rail */
.profile-center { justify-content: stretch; }
.feature-card {
  background: #000;
  border: none;
  width: 100%;
  height: 100%;                 /* fill from top to bottom of page padding */
  display: flex;
  align-items: center;          /* center horizontally */
  justify-content: center;      /* center vertically */
  padding: clamp(12px, 1.6vw, 16px);
  box-sizing: border-box;
}

/* Book + metadata as a centered stack that can shrink */
.feature-stack {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: clamp(8px, 1.2vh, 12px);
  max-height: 100%;
  /* keep the whole block centered within the card */
}

:root {
  /* a height-driven scale that guarantees everything fits on short screens */
  --fit-w: clamp(120px, 22vh, 240px);
}

/* Make the *book* smaller while keeping the black card as-is */
.feature-cover-placeholder {
  width: var(--fit-w);               /* shrinks on short viewports */
  aspect-ratio: 12 / 17;
  background: #1b1b1b;
  border: none;
}

/* Keep metadata centered but capped to book width */
.feature-info {
  width: 100%;
  max-width: var(--fit-w);           /* match book width cap */
  margin: 0 auto;
  text-align: center;
  overflow: hidden;                  /* prevent spill */
}

.feature-title {
  margin: 0 0 6px;
  font-size: clamp(0.95rem, 1.6vh, 1.15rem);
  font-weight: 800;
}

/* subtle separators */
.meta-hr {
  border: 0;
  height: 1px;
  background: rgba(255,255,255,0.12);
  margin: clamp(6px, 1vh, 8px) 0;
}

/* Author row */
.feature-author {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  min-height: 28px;
}
.meta-avatar--sm { width: 26px; height: 26px; display: inline-flex; align-items: center; justify-content: center; }
.meta-avatar--sm svg { width: 26px; height: 26px; }
.feature-author-name { font-weight: 600; font-size: clamp(0.9rem, 1.4vh, 1rem); }

/* Actions */
.meta-actions {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: clamp(8px, 1.2vh, 12px);
}

/* Left-aligned sub-blocks inside centered column */
.align-left {
  text-align: left;
  margin: 0 auto;
  max-width: var(--fit-w);
  font-size: clamp(0.85rem, 1.4vh, 1rem);
}

/* Genres stacked vertically and safe on small screens */
.feature-info .meta-tags { padding: 0; margin: 0; }
.feature-info .meta-tags li { list-style: none; }
.vertical-tags {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  gap: clamp(4px, 0.8vh, 6px);
  max-height: 24vh;           /* never push out of the card */
  overflow: hidden;           /* keep page static */
}

/* RIGHT column — library */
.right-title { display: flex; align-items: baseline; gap: 6px; }
.shelf {
  background: #4b2419;
  padding: 16px;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 0;
  height: var(--shelf-h);
  display: flex;
  flex-direction: column;
  gap: 16px;
}
.shelf-row {
  background: #111;
  flex: 1; /* three perfectly even rows */
  box-shadow: inset 0 3px 0 rgba(0,0,0,0.25);
  border-radius: 0;
}

/* Size tokens */
.profile-app {
  --strip-h: clamp(140px, 18vh, 180px);
  --shelf-h: clamp(360px, 52vh, 600px); /* a touch thicker */
}

/* Height-based scaling to avoid overflow on short screens */
@media (max-height: 760px) {
  .profile-app { --strip-h: clamp(120px, 16vh, 160px); --shelf-h: clamp(320px, 48vh, 560px); }
}
@media (max-height: 640px) {
  .profile-app { --strip-h: clamp(100px, 14vh, 140px); --shelf-h: clamp(280px, 44vh, 520px); }
}

/* Width tweaks — keep center rail reasonable, avoid cutoffs */
@media (max-width: 900px) {
  .profile-grid {
    grid-template-columns: minmax(0, 1fr) clamp(220px, 42vw, 320px) minmax(0, 1fr);
    gap: 12px;
  }
}

/* --- Keep page static, no scroll (already in place) --- */
.profile-app { height: 100svh; overflow: hidden; }

/* --- Center card still fills column and centers its content --- */
.feature-card {
  display: flex;
  align-items: center;     /* center horizontally */
  justify-content: center; /* center vertically */
}

/* --- The stack (book + metadata) must be allowed to shrink --- */
.feature-stack,
.feature-info,
.align-left {
  min-width: 0; /* critical for flex children to shrink instead of overflow */
}

/* --- Make book width never exceed the center column on narrow screens --- */
/* Book and metadata share the same dynamic max width token */
:root {
  /* Height-driven fit (so it shrinks on short screens) AND guard by viewport width */
  --fit-w: min(clamp(120px, 22vh, 240px), 40vw);
}
.feature-cover-placeholder { width: var(--fit-w); }
.feature-info { width: 100%; max-width: var(--fit-w); margin: 0 auto; }

/* --- Ensure text can wrap inside the narrow column --- */
.feature-info,
.feature-title,
.feature-author-name,
.align-left,
.align-left * {
  overflow-wrap: anywhere;  /* allow breaking anywhere if needed */
  word-break: break-word;   /* break long tokens */
  hyphens: auto;            /* nicer hyphenation when supported */
}

/* Titles/labels scale down on small screens to prevent overflow */
.section-title        { font-size: clamp(1rem, 1.3vw, 1.5rem); }
.feature-title        { font-size: clamp(0.9rem, 1.6vh, 1.1rem); }
.feature-author-name  { font-size: clamp(0.85rem, 1.4vh, 1rem); }
.align-left           { font-size: clamp(0.8rem, 1.4vh, 1rem); }

/* --- Actions can wrap so buttons never push outside --- */
.meta-actions {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: clamp(6px, 1vh, 10px);
  flex-wrap: wrap;       /* allow wrapping on tight widths */
  max-width: 100%;
}
.meta-actions > * {
  min-width: 0;          /* prevent intrinsic expansion */
  flex: 0 1 auto;
}

/* --- Genres: vertical list, never wider than container --- */
.vertical-tags {
  display: flex;
  flex-direction: column;
  align-items: flex-start;   /* left-align per spec */
  gap: clamp(4px, 0.8vh, 6px);
  max-height: 24vh;          /* stay within card height */
  overflow: hidden;          /* avoid page scroll */
}
.feature-info .meta-tags { padding: 0; margin: 0; }
.feature-info .meta-tags li {
  list-style: none;
  max-width: 100%;
  overflow: hidden;
  text-overflow: ellipsis;   /* graceful truncation for super-long entries */
}

/* --- Keep the whole block centered regardless of content length --- */
.feature-card { text-align: center; }
.feature-info  { text-align: center; }
.align-left    { text-align: left; margin-left: auto; margin-right: auto; }

/* --- Small widths: slightly narrower center rail so nothing cuts off --- */
@media (max-width: 900px) {
  .profile-grid {
    grid-template-columns: minmax(0, 1fr) clamp(220px, 42vw, 320px) minmax(0, 1fr);
  }
}

/* --- Center the whole book+metadata block rigorously --- */
.feature-card {
  display: flex;
  align-items: center;     /* horizontal center */
  justify-content: center; /* vertical center */
  text-align: center;
}
.feature-stack {
  display: flex;
  flex-direction: column;
  align-items: center;     /* center children */
  justify-content: center;
  gap: clamp(6px, 1.2vh, 10px);
  min-width: 0;            /* allow shrinking */
}

/* --- Never let inner blocks force overflow --- */
.feature-stack,
.feature-info,
.align-left {
  min-width: 0;
}

/* Use a shared width token for book + metadata so they track each other */
:root { --fit-w: min(clamp(120px, 22vh, 240px), 40vw); }
.feature-cover-placeholder { width: var(--fit-w); }
.feature-info {
  width: 100%;
  max-width: var(--fit-w);
  margin: 0 auto;
}

/* --- Keep actions on one line; scale down instead of wrapping --- */
.feature-card .meta-actions {
  display: flex;
  flex-wrap: nowrap;                 /* never wrap */
  white-space: nowrap;               /* keep counts tight */
  justify-content: center;
  align-items: center;
  gap: clamp(6px, 1vw, 12px);
  width: 100%;
  max-width: var(--fit-w);
}

/* Tighten the action buttons themselves */
.feature-card .meta-actions .meta-icon-btn {
  padding: clamp(2px, 0.4vh, 6px) clamp(6px, 0.6vh, 10px);
  border-radius: 10px;
  min-width: 0;
  flex: 0 1 auto; /* allow shrink */
}

/* Shrink the icon + numbers responsively */
.feature-card .meta-actions .meta-icon-glyph {
  font-size: clamp(16px, 2.1vh, 22px);
}
.feature-card .meta-actions .meta-icon-count {
  font-size: clamp(0.7rem, 1.4vh, 0.9rem);
}

/* --- Metadata text must wrap & scale gracefully --- */
.feature-title        { font-size: clamp(0.85rem, 1.6vh, 1.1rem); line-height: 1.2; }
.feature-author-name  { font-size: clamp(0.8rem, 1.4vh, 1rem);    line-height: 1.2; }
.align-left           { font-size: clamp(0.78rem, 1.35vh, 0.95rem); line-height: 1.25; }

.feature-info,
.feature-title,
.feature-author-name,
.align-left,
.align-left * {
  overflow-wrap: anywhere;
  word-break: break-word;
  hyphens: auto;
}

/* Genres: always fully visible; stack vertically and fit container */
.feature-info .meta-tags { padding: 0; margin: 0; }
.feature-info .meta-tags li {
  list-style: none;
  max-width: 100%;
  overflow: hidden;
  text-overflow: ellipsis;
}
.vertical-tags {
  display: flex;
  flex-direction: column;
  align-items: flex-start;        /* left align as requested */
  gap: clamp(4px, 0.8vh, 6px);
  /* No max-height here so all genres remain visible */
}

/* --- Tight screen heuristics: progressively shrink everything to avoid overflow while keeping one-line actions --- */
@media (max-height: 820px), (max-width: 820px) {
  :root { --fit-w: min(clamp(110px, 20vh, 220px), 42vw); }
  .feature-card .meta-actions { gap: clamp(4px, 1vw, 10px); }
  .feature-card .meta-actions .meta-icon-glyph { font-size: clamp(15px, 2vh, 20px); }
  .feature-card .meta-actions .meta-icon-count  { font-size: clamp(0.68rem, 1.3vh, 0.85rem); }
  .feature-title { font-size: clamp(0.82rem, 1.5vh, 1rem); }
  .align-left    { font-size: clamp(0.75rem, 1.25vh, 0.92rem); }
}

@media (max-height: 700px), (max-width: 600px) {
  :root { --fit-w: min(clamp(100px, 18vh, 200px), 46vw); }
  .feature-card .meta-actions .meta-icon-glyph { font-size: clamp(14px, 1.9vh, 18px); }
  .feature-card .meta-actions .meta-icon-count  { font-size: clamp(0.64rem, 1.2vh, 0.8rem); }
  .feature-title { font-size: clamp(0.78rem, 1.4vh, 0.95rem); }
  .align-left    { font-size: clamp(0.72rem, 1.15vh, 0.88rem); }
}

/* Ensure the page itself never scrolls; components must shrink to fit */
.profile-app { height: 100svh; overflow: hidden; }


/* === Stretch actions full width + keep one row === */
.profile-page .feature-card .meta-actions {
  width: 100%;
  max-width: var(--fit-w);     /* same width token as book/metadata */
  display: flex;
  flex-wrap: nowrap;           /* never wrap onto 2nd line */
  gap: clamp(6px, 1.2vw, 12px);
  container-type: inline-size; /* lets us use cqw to auto-scale contents */
}

.profile-page .feature-card .meta-actions .meta-icon-btn {
  flex: 1 1 0;                 /* each button occupies 1/3 of the row */
  display: flex;
  align-items: center;
  justify-content: center;
  gap: clamp(4px, 1cqw, 8px);  /* gap also scales with row width */
  min-width: 0;                /* allow shrinking inside */
  padding: clamp(4px, 1.2cqw, 8px) clamp(6px, 1.6cqw, 12px);
}

/* Scale icon and count based on row width so they don't stack */
.profile-page .feature-card .meta-actions .meta-icon-glyph {
  font-size: clamp(16px, 6cqw, 22px);
  line-height: 1;
}
.profile-page .feature-card .meta-actions .meta-icon-count {
  font-size: clamp(0.7rem, 3.2cqw, 0.95rem);
  line-height: 1.1;
  white-space: nowrap;
  min-width: 0;
}

/* Tighten smallest screens a bit more to keep one row */
@media (max-width: 560px), (max-height: 700px) {
  .profile-page .feature-card .meta-actions { gap: clamp(4px, 1cqw, 8px); }
  .profile-page .feature-card .meta-actions .meta-icon-glyph { font-size: clamp(15px, 5.2cqw, 20px); }
  .profile-page .feature-card .meta-actions .meta-icon-count { font-size: clamp(0.66rem, 2.8cqw, 0.85rem); }
}

/* === Keep "Chapters" to exactly one line; shrink if needed === */
.profile-page .feature-info {
  container-type: inline-size; /* enable cqw for the metadata block */
}

.profile-page .feature-info .meta-chapters {
  white-space: nowrap;         /* force single line */
  overflow: hidden;            /* never spill out of the card */
  text-overflow: clip;         /* we’ll prefer shrink over ellipsis */
  font-size: clamp(0.72rem, 3.2cqw, 0.95rem); /* auto-scale with width */
  line-height: 1.2;
  margin: 0;                   /* ensure no extra height */
}

/* (Optional) If you want an extra safety net, allow a tiny scale down
   just before it would overflow. This keeps it one line without clipping. */
.profile-page .feature-info .meta-chapters > span {
  display: inline-block;
  max-width: 100%;
  transform-origin: left center;
}
@container (max-width: 180px) {
  .profile-page .feature-info .meta-chapters > span { transform: scale(0.96); }
}
@container (max-width: 160px) {
  .profile-page .feature-info .meta-chapters > span { transform: scale(0.92); }
}

