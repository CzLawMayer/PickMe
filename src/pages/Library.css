/* =========================
   Library.css (scoped, clean)
   ========================= */

/* --- Page tokens --- */
.library-app {
  --ink: #fff;
  --app-header-h: 64px;
  --pad-x: 28px;
  --icon-box: 40px;
  --icon-size: 22px;

  --hero-min-h: clamp(96px, 12vw, 168px);
  --hero-gap: clamp(12px, 2vw, 24px);
  --tab-h: clamp(36px, 4.2vw, 52px);
  --tab-radius: clamp(18px, 2.8vw, 28px);
}

/* --- App frame --- */
.library-app {
  min-height: 100svh;
  color: var(--ink);
  display: flex;
  flex-direction: column;
}

/* Header */
.library-app > .header {
  height: var(--app-header-h);
  padding: 0 var(--pad-x);
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: #000;
  box-sizing: border-box;
  z-index: 900;
}
.header .logo { margin: 0; font-size: 28px; font-weight: 800; line-height: 1; }
.header .logo .logo-link { display: inline-block; line-height: 1; color: inherit; text-decoration: none; }
.header .header-icons { display: grid; grid-auto-flow: column; align-items: center; gap: 12px; }
.header .icon {
  display: inline-grid; place-items: center;
  width: var(--icon-box); height: var(--icon-box);
  font-size: var(--icon-size);
  background: transparent; border: 0; color: inherit; border-radius: 8px; cursor: pointer;
}

/* --- Body layout (content + right rail) --- */
.library-layout {
  display: grid;
  grid-template-columns: 1fr 340px;
  min-height: calc(100svh - var(--app-header-h));
}
.library-left { display: flex; flex-direction: column; min-width: 0; }

/* --- Top banner (identity + tabs) --- */
.lib-hero {
  display: grid !important;
  grid-template-columns: minmax(420px, auto) 1fr !important; /* identity | tabs */
  align-items: center;
  column-gap: clamp(32px, 5vw, 65px);
  min-height: var(--hero-min-h);
  padding: clamp(10px, 1.4vw, 18px) var(--pad-x);
  background: #121212;
  border-bottom: 1px solid rgba(255,255,255,.06);
}

/* Identity block */
.library-app .lib-hero .identity-cell { min-width: 420px !important; width: auto !important; }
.library-app .lib-hero .profile-card {
  display: grid !important;
  grid-template-columns: auto 1fr !important;
  align-items: center;
  column-gap: clamp(10px, 1.6vw, 14px);
}
.library-app .lib-hero .profile-id { min-width: 0 !important; }
.library-app .lib-hero .profile-name,
.library-app .lib-hero .profile-handle { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

/* Avatar (round, no border) */
.library-app .lib-hero .profile-card .profile-avatar {
  width: 100px !important; height: 100px !important; border: 0 !important; border-radius: 50% !important;
  overflow: hidden; aspect-ratio: 1 / 1 !important;
}
.library-app .lib-hero .profile-card .profile-avatar img,
.library-app .lib-hero .profile-card .profile-avatar svg { width: 100% !important; height: 100% !important; object-fit: cover; }

/* Tabs row */
.lib-tabs {
  display: flex; align-items: center; justify-content: flex-start;
  gap: clamp(10px, 1.6vw, 16px);
  flex-wrap: wrap; white-space: normal; min-width: 0;
  margin-left: clamp(32px, 4vw, 100px);
}
.lib-tab {
  display: inline-flex; align-items: center; justify-content: center;
  height: var(--tab-h);
  padding-inline: clamp(14px, calc(var(--tab-h) * 0.5), 28px);
  border-radius: var(--tab-radius);
  font-weight: 800; font-size: clamp(14px, calc(var(--tab-h) * 0.34), 18px); line-height: 1;
  background: #111; color: #fff; text-decoration: none;
  border: 1px solid rgba(255,255,255,.06);
  transition: transform 120ms ease, filter 120ms ease;
  cursor: pointer;
}
.lib-tab:hover { transform: translateY(-1px); filter: brightness(1.05); }
.lib-tab:active { transform: translateY(0); }
.lib-tab.is-active,
.lib-tab[aria-current="page"] { background: #ff4081; border-color: transparent; color: #fff; }

/* Main content padding */
.lib-content { padding: 16px var(--pad-x); }

/* Right rail (FeaturePanel) */
.library-feature { background: #000; display: flex; align-items: stretch; justify-content: center; padding: 0; }
.library-feature .feature-card { width: 100%; height: 100%; max-width: none; background: #000; box-shadow: none; }

/* SideMenu layering */
.menu-overlay { z-index: 950; }
.side-menu    { z-index: 960; }

/* --- Responsive hero tweaks --- */
@media (max-width: 820px) {
  .lib-hero { grid-template-columns: 1fr !important; row-gap: 12px; }
  .lib-tabs { margin-left: 0; }
}
@media (max-width: 600px) { .lib-tabs { margin-left: clamp(18px, 3vw, 36px); } }
@media (max-width: 420px) {
  .lib-hero { grid-template-columns: minmax(360px, auto) 1fr !important; }
  .library-app .lib-hero .identity-cell { min-width: 360px !important; }
  .lib-tabs { margin-left: clamp(10px, 2vw, 22px); }
  .lib-tab {
    height: clamp(28px, 7vw, 38px);
    padding-inline: clamp(6px, 1.8vw, 14px);
    font-size: clamp(11px, 3.4vw, 14px);
  }
}

/* =========================
   Work area (4 equal cols)
   ========================= */
.library-app .lib-row {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 16px;
  padding: 16px var(--pad-x);
  align-items: start;
  min-width: 0;
}
@media (max-width: 820px) { .library-app .lib-row { gap: 12px; } }
.library-app .lib-col { min-width: 0; }

/* Card: cover + 5 lines (grid) */
/* IMPORTANT: overflow hidden so the card/book NEVER grows. */
.library-app .lib-card {
  container-type: inline-size;
  container-name: libcol;

  --card-h: clamp(135px, 40cqw, 180px) !important;
  --rows: 5;
  --row-gap: 8px;
  --row-h: calc((var(--card-h) - ((var(--rows) - 1) * var(--row-gap))) / var(--rows));

  display: grid;
  grid-template-columns: calc(var(--card-h) * 2 / 3) 1fr; /* cover | details */
  gap: 12px;
  height: var(--card-h);
  min-width: 0;
  overflow: hidden; /* keep size fixed */
}

/* Cover (2:3 ratio, stretches to card height) */
.library-app .lib-cover {
  width: 100%; height: 100%;
  background: #2a2a2a; border-radius: 4px; overflow: hidden;
}

/* Details: 5 equal rows (also fixed) */
.library-app .lib-details {
  display: grid; grid-template-rows: repeat(5, 1fr);
  gap: var(--row-gap); height: 100%; min-width: 0;
  overflow: hidden; /* prevent stretch */
}
.library-app .lib-line {
  display: flex; align-items: center;
  padding: 8px 10px;
  border: 1px solid rgba(255,255,255,0.12);
  border-radius: 6px;
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis; line-height: 1.2;
}
@media (max-width: 720px) {
  .library-app .lib-card { gap: 10px; }
  .library-app .lib-details { gap: 6px; }
  .library-app .lib-line { padding: 6px 8px; }
}

/* =========================
   Inline actions (icons + counts)
   ========================= */
.lib-row-actions.is-inline {
  display: flex; align-items: center; justify-content: flex-start;
  gap: 8px !important;
  min-height: 44px;
  padding: 0 !important;
  flex-wrap: nowrap !important;
  min-width: 0;
  overflow: visible;   /* popover can overlap rows */
  font-size: 16px;     /* row scale (em) */
}

.lib-row-actions.is-inline .meta-icon-btn {
  display: inline-flex !important;
  align-items: center !important;
  flex-direction: row !important;
  flex-wrap: nowrap !important;
  gap: 4px !important;
  padding: 0 !important;
  flex: 0 0 auto;
  white-space: nowrap;
}
.lib-row-actions.is-inline .meta-icon-btn > * {
  display: inline-block !important;
  width: auto !important;
  flex: 0 0 auto !important;
}

.lib-row-actions.is-inline .meta-icon-glyph { font-size: 1.78em !important; line-height: 1; }
.lib-row-actions.is-inline .meta-icon-count { font-size: 1.14em !important; line-height: 1; margin-left: 2px !important; }

/* Active colors */
.meta-icon-btn.is-active.like .meta-icon-glyph { --ms-fill: 1; color: #d81b60; }
.meta-icon-btn.is-active.save .meta-icon-glyph { --ms-fill: 1; color: #6a1b9a; }
.meta-icon-btn.is-active.star .meta-icon-glyph { --ms-fill: 1; color: #f2ac15; }

.lib-row-actions.is-inline .meta-icon-btn:hover .meta-icon-glyph { filter: drop-shadow(0 0 .4px rgba(255,255,255,.35)); }
.lib-row-actions.is-inline .meta-icon-btn:active .meta-icon-glyph { transform: translateY(1px) scale(.98); }

@media (max-width: 520px) {
  .lib-row-actions.is-inline { flex-wrap: wrap; row-gap: 10px; }
}

@container libcol (max-width: 660px) {
  .lib-row-actions.is-inline { font-size: clamp(12px, 2.2cqw, 16px); gap: 6px !important; }
  .lib-row-actions.is-inline .meta-icon-btn { gap: 3px !important; }
}
@container libcol (max-width: 520px) {
  .lib-row-actions.is-inline { font-size: clamp(11px, 2.8cqw, 15px); gap: 5px !important; }
  .lib-row-actions.is-inline .meta-icon-btn { gap: 2px !important; }
}
@container libcol (max-width: 420px) {
  .lib-row-actions.is-inline { font-size: clamp(10px, 3.4cqw, 14px); gap: 4px !important; }
}

/* =========================
   STAR POPOVER — body-level portal
   (never affects layout; never clipped)
   ========================= */

/* Full-screen, click-through overlay. You only click the surface. */
.pm-star-portal {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 1600; /* above cards/rails */
}

/* The actual bubble; positioned by inline top/left from the component. */
.pm-star-surface {
  position: fixed;                 /* OUTSIDE layout flow */
  top: var(--pm-top, 0px);         /* set via inline style */
  left: var(--pm-left, 0px);       /* set via inline style */
  transform: translate(-50%, -10px);
  pointer-events: auto;
  background: rgba(20, 20, 20, 0.96);
  border: 1px solid rgba(255,255,255,.18);
  border-radius: 10px;
  padding: 10px 12px;
  box-shadow: 0 10px 28px rgba(0,0,0,.5);
  min-width: 180px;
}

/* Stars row + hover preview */
.pm-star-row {
  display: inline-flex;
  gap: 6px;
  align-items: center;
  justify-content: center;
  font-size: 22px;
  user-select: none;
}
.pm-star-row[data-hover="1"] .pm-star:nth-child(-n+1),
.pm-star-row[data-hover="2"] .pm-star:nth-child(-n+2),
.pm-star-row[data-hover="3"] .pm-star:nth-child(-n+3),
.pm-star-row[data-hover="4"] .pm-star:nth-child(-n+4),
.pm-star-row[data-hover="5"] .pm-star:nth-child(-n+5) { color: #ffd36a; }

/* Star buttons */
.pm-star {
  appearance: none;
  background: transparent;
  border: 0;
  cursor: pointer;
  padding: 0 2px;
  line-height: 1;
  font-size: inherit;
  color: #8c8c8c;
  transition: transform 120ms ease, color 120ms ease;
}
.pm-star:hover { transform: translateY(-1px); }
.pm-star.is-on { color: #f2ac15; }

.pm-star-hint {
  margin-top: 6px;
  font-size: 12px;
  opacity: .85;
  text-align: center;
}

/* (Optional) legacy .lib-actions */
.library-app .lib-actions {
  display: inline-flex; align-items: center;
  gap: 8px !important; white-space: nowrap; min-width: 0; overflow: hidden; height: 100%;
  font-size: clamp(12px, 1.6vw, 16px) !important;
}
.library-app .lib-actions .meta-icon-btn {
  display: inline-flex !important; align-items: center !important;
  height: var(--row-h) !important; max-height: var(--row-h) !important;
  padding: 0 !important; gap: clamp(2px, 0.6vw, 6px) !important;
  white-space: nowrap; box-sizing: border-box; overflow: hidden; flex: 0 0 auto;
}
.library-app .lib-actions .meta-icon-glyph { font-size: 1em !important; line-height: 1; }
.library-app .lib-actions .meta-icon-count { font-size: 0.85em !important; line-height: 1; margin-left: 4px; }
@media (max-width: 900px) { .library-app .lib-actions { font-size: clamp(11px, 1.8vw, 14px) !important; } }
@media (max-width: 700px) { .library-app .lib-actions { font-size: clamp(10px, 2.4vw, 13px) !important; } }

/* =========================
   End
   ========================= */

/* === Add this (or merge with your existing shared icon styles) === */

/* Every inline meta action button (like, star, save) */
.meta-icon-btn {
  position: relative;          /* THIS is the key fix */
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 4px;
  background: transparent;
  border: 0;
  padding: 0;
  line-height: 1;
  font: inherit;
  color: inherit;
  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
  user-select: none;
  outline: none;
}

/* icon itself inside the button */
.meta-icon-glyph {
  font-size: 1.78em;
  line-height: 1;
}

/* number next to the icon */
.meta-icon-count {
  font-size: 1.14em;
  line-height: 1;
  margin-left: 2px;
}

/* active color states (same as other pages) */
.meta-icon-btn.is-active.like .meta-icon-glyph { --ms-fill: 1; color: #d81b60; }
.meta-icon-btn.is-active.star .meta-icon-glyph { --ms-fill: 1; color: #f2ac15; }
.meta-icon-btn.is-active.save .meta-icon-glyph { --ms-fill: 1; color: #6a1b9a; }

.meta-icon-btn:active .meta-icon-glyph {
  transform: scale(0.95);
}

.meta-icon-btn:focus {
  outline: none;
  box-shadow: none;
}

/* popover styling (unchanged from working pages) */
.star-popover {
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translate(-50%, -8px);
  background: rgba(20, 20, 20, 0.95);
  border: 1px solid rgba(255,255,255,.2);
  border-radius: 10px;
  padding: 8px 10px;
  box-shadow: 0 8px 22px rgba(0,0,0,.45);
  z-index: 10;
  min-width: 160px;
}

.star-row {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
}

.star-item {
  appearance: none;
  background: transparent;
  border: none;
  padding: 4px;
  cursor: pointer;
  line-height: 1;
  border-radius: 6px;
  transition: transform 100ms ease;
}

.star-item:hover {
  transform: scale(1.1);
}

.star-hint {
  text-align: center;
  font-size: 12px;
  opacity: .85;
  margin-top: 6px;
}

/* floating version of the popover when used in Library */
.star-popover-floating {
  position: fixed;          /* take it out of layout completely */
  transform: translate(-50%, -8px);
  z-index: 2000;
  min-width: 160px;
  /* we intentionally do NOT set background/border/etc here,
     we inherit those from .star-popover so it looks identical */
}

/* The original .star-popover still defines:
   background, border, border-radius, padding, box-shadow, etc.
   We keep that.
   This helper ONLY handles viewport positioning.
*/
.star-popover-floating {
  position: fixed;            /* float above layout */
  transform: translateX(-50%);/* center horizontally on the star */
  z-index: 2000;              /* above card */
  min-width: 160px;
}

/* Floating version of the popover for Library.
   We keep all visuals from .star-popover, we ONLY change positioning.
*/
.star-popover-floating {
  position: fixed;
  z-index: 2000;
  min-width: 160px;
  /* no bottom / no left / no transform here – we set those inline in style={} */
}

/* Force the floating rating bubble to render as a full padded box above the star button */
.star-popover-floating {
  position: fixed;                  /* keep it out of layout so it won't squeeze the card */
  z-index: 2000;

  /* full bubble visuals (override anything older) */
  background: rgba(20, 20, 20, 0.95) !important;
  border: 1px solid rgba(255, 255, 255, 0.2) !important;
  border-radius: 10px !important;
  box-shadow: 0 8px 22px rgba(0, 0, 0, 0.45) !important;

  padding: 8px 10px !important;
  min-width: 160px !important;
  max-width: 220px;
  display: inline-block !important;

  /* make sure the box actually wraps its children vertically */
  box-sizing: border-box;
  overflow: visible;
}

/* stars row inside the popover */
.star-popover-floating .star-row {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  margin: 0 0 6px 0;        /* give space above the hint */
}

/* each clickable star */
.star-popover-floating .star-item {
  appearance: none;
  background: transparent;
  border: none;
  padding: 4px;
  cursor: pointer;
  line-height: 1;
  border-radius: 6px;
  transition: transform 100ms ease;
}
.star-popover-floating .star-item:hover {
  transform: scale(1.1);
}

/* the little text under the stars ("Choose rating", "4/5", etc.) */
.star-popover-floating .star-hint {
  text-align: center;
  font-size: 12px;
  opacity: 0.85;
  line-height: 1.3;
  white-space: nowrap;
}

/* keep the yellow fill for active stars */
.star-popover-floating .material-symbols-outlined {
  font-size: 28px;
  color: #f2ac15;
}
.star-popover-floating .material-symbols-outlined[style*="--ms-fill: 0"] {
  /* if we passed --ms-fill:0 inline, show default color instead of yellow */
  color: inherit;
}

/* === tighten library rows (no side padding / no outline) === */
.library-app .lib-line {
  padding-left: 0 !important;
  padding-right: 0 !important;
  border: 0 !important;
  background: transparent !important;
  border-radius: 0 !important;
}

/* make sure icon row also hugs edges and has no outline */
.lib-row-actions.is-inline {
  padding-left: 0 !important;
  padding-right: 0 !important;
  border: 0 !important;
  background: transparent !important;
  border-radius: 0 !important;
}

/* kill focus outline / glow on meta buttons in the rows */
.meta-icon-btn {
  outline: none !important;
  box-shadow: none !important;
  background: transparent !important;
  border: 0 !important;
}
.meta-icon-btn:focus {
  outline: none !important;
  box-shadow: none !important;
}

/* Row 1: book title (bigger + bold) */
.library-app .lib-details > .lib-line:nth-child(1) {
  font-size: 1rem;              /* bump size */
  font-weight: 700;             /* bold */
  line-height: 1.2;
  color: #fff;                  /* keep pure white for title */
}

/* Row 3: author (dimmer white) */
.library-app .lib-details > .lib-line:nth-child(3) {
  color: rgba(255,255,255,0.6); /* softer white */
  font-weight: 400;
}

/* Pull author (row 3) closer to year (row 2) */
.library-app .lib-details > .lib-line:nth-child(3) {
  margin-top: -12px; /* tighten year ↔ author */
}

/* Pull personal stars (row 5) closer to the buttons row (row 4) */
.library-app .lib-details > .lib-line:nth-child(5) {
  margin-top: -25px; /* tighten buttons ↔ stars */
}

/* Make book title bigger, bold, and allow wrapping to 2 lines */
.library-app .lib-details > .lib-line:nth-child(1) {
  font-size: 1.25em;       /* bigger than before */
  font-weight: 700;        /* bold */
  line-height: 1.2;

  white-space: normal;     /* allow wrapping */
  overflow: visible;       /* don't clip */
  text-overflow: clip;     /* no ellipsis */

  display: -webkit-box;          /* allow multi-line clamp */
  -webkit-box-orient: vertical;
  -webkit-line-clamp: 2;         /* max 2 lines */
  max-height: calc(1.2em * 2);   /* keeps card height sane */
}

/* Add extra space after the title row before the year row */
.library-app .lib-details > .lib-line:nth-child(1) {
  margin-bottom: 12px; /* new spacing under title */
}

/* Year row pulls up a bit tighter toward the title, not toward author */
.library-app .lib-details > .lib-line:nth-child(2) {
  margin-top: 0;
}

/* Allow the author row (row 3) to wrap to 2 lines if needed */
.library-app .lib-details > .lib-line:nth-child(3) {
  white-space: normal;
  overflow: visible;
  text-overflow: clip;

  line-height: 1.2;

  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-line-clamp: 2;          /* max 2 lines like title */
  max-height: calc(1.2em * 2);    /* keep card height sane */
}

/* ---------- Scroll behavior for the books grid ---------- */

/* The whole 2-column layout is already min-height: calc(100svh - header),
   so the left column has a fixed vertical budget. We prevent the left column
   from overflowing, and let only .library-scroll handle overflow. */
.library-left {
  min-height: calc(100svh - var(--app-header-h));
  overflow: hidden;          /* hide any spill from children */
  display: flex;
  flex-direction: column;
  min-width: 0;
}

/* This is the scrollable region (books + below).
   It fills the remaining height under the hero. */
.library-scroll {
  flex: 1 1 auto;
  min-height: 0;             /* VERY important: allows flex child to scroll */
  overflow-y: auto;
  overflow-x: hidden;
}

/* Optional: make the scrollbar appear right beside the FeaturePanel column
   (which it will naturally, since .library-scroll fills the left column).
   You can style it a bit to be slimmer. */
.library-scroll::-webkit-scrollbar {
  width: 6px;
}
.library-scroll::-webkit-scrollbar-track {
  background: rgba(255,255,255,0.05);
}
.library-scroll::-webkit-scrollbar-thumb {
  background: rgba(255,255,255,0.28);
  border-radius: 3px;
}
.library-scroll::-webkit-scrollbar-thumb:hover {
  background: rgba(255,255,255,0.4);
}

