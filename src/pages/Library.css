/* =========================
   Library.css (scoped, clean)
   ========================= */

/* --- Page tokens --- */
.library-app {
  --ink: #fff;
  --app-header-h: 64px;
  --pad-x: 28px;
  --icon-box: 40px;
  --icon-size: 22px;

  --hero-min-h: clamp(96px, 12vw, 168px);
  --hero-gap: clamp(12px, 2vw, 24px);
  --tab-h: clamp(36px, 4.2vw, 52px);
  --tab-radius: clamp(18px, 2.8vw, 28px);
}

/* --- App frame --- */
.library-app {
  min-height: 100svh;
  color: var(--ink);
  display: flex;
  flex-direction: column;
}

/* Header */
.library-app > .header {
  height: var(--app-header-h);
  padding: 0 var(--pad-x);
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: #000;
  box-sizing: border-box;
  z-index: 900;
}
.header .logo { margin: 0; font-size: 28px; font-weight: 800; line-height: 1; }
.header .logo .logo-link { display: inline-block; line-height: 1; color: inherit; text-decoration: none; }
.header .header-icons { display: grid; grid-auto-flow: column; align-items: center; gap: 12px; }
.header .icon {
  display: inline-grid; place-items: center;
  width: var(--icon-box); height: var(--icon-box);
  font-size: var(--icon-size);
  background: transparent; border: 0; color: inherit; border-radius: 8px; cursor: pointer;
}

/* --- Body layout (content + right rail) --- */
.library-layout {
  display: grid;
  grid-template-columns: 1fr 340px;
  min-height: calc(100svh - var(--app-header-h));
}
.library-left { display: flex; flex-direction: column; min-width: 0; }

/* --- Top banner (identity + tabs) --- */
.lib-hero {
  display: grid !important;
  grid-template-columns: minmax(420px, auto) 1fr !important; /* identity | tabs */
  align-items: center;
  column-gap: clamp(32px, 5vw, 65px);
  min-height: var(--hero-min-h);
  padding: clamp(10px, 1.4vw, 18px) var(--pad-x);
  background: #121212;
  border-bottom: 1px solid rgba(255,255,255,.06);
}

/* Identity block */
.library-app .lib-hero .identity-cell { min-width: 420px !important; width: auto !important; }
.library-app .lib-hero .profile-card {
  display: grid !important;
  grid-template-columns: auto 1fr !important;
  align-items: center;
  column-gap: clamp(10px, 1.6vw, 14px);
}
.library-app .lib-hero .profile-id { min-width: 0 !important; }
.library-app .lib-hero .profile-name,
.library-app .lib-hero .profile-handle { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

/* Avatar (round, no border) */
.library-app .lib-hero .profile-card .profile-avatar {
  width: 100px !important; height: 100px !important; border: 0 !important; border-radius: 50% !important;
  overflow: hidden; aspect-ratio: 1 / 1 !important;
}
.library-app .lib-hero .profile-card .profile-avatar img,
.library-app .lib-hero .profile-card .profile-avatar svg { width: 100% !important; height: 100% !important; object-fit: cover; }

/* Tabs row */
.lib-tabs {
  display: flex; align-items: center; justify-content: flex-start;
  gap: clamp(10px, 1.6vw, 16px);
  flex-wrap: wrap; white-space: normal; min-width: 0;
  margin-left: clamp(32px, 4vw, 100px);
}
.lib-tab {
  display: inline-flex; align-items: center; justify-content: center;
  height: var(--tab-h);
  padding-inline: clamp(14px, calc(var(--tab-h) * 0.5), 28px);
  border-radius: var(--tab-radius);
  font-weight: 800; font-size: clamp(14px, calc(var(--tab-h) * 0.34), 18px); line-height: 1;
  background: #111; color: #fff; text-decoration: none;
  border: 1px solid rgba(255,255,255,.06);
  transition: transform 120ms ease, filter 120ms ease;
  cursor: pointer;
}
.lib-tab:hover { transform: translateY(-1px); filter: brightness(1.05); }
.lib-tab:active { transform: translateY(0); }
.lib-tab.is-active,
.lib-tab[aria-current="page"] { background: #ff4081; border-color: transparent; color: #fff; }

/* Main content padding */
.lib-content { padding: 16px var(--pad-x); }

/* Right rail (FeaturePanel) */
.library-feature { background: #000; display: flex; align-items: stretch; justify-content: center; padding: 0; }
.library-feature .feature-card { width: 100%; height: 100%; max-width: none; background: #000; box-shadow: none; }

/* SideMenu layering */
.menu-overlay { z-index: 950; }
.side-menu    { z-index: 960; }

/* --- Responsive hero tweaks --- */
@media (max-width: 820px) {
  .lib-hero { grid-template-columns: 1fr !important; row-gap: 12px; }
  .lib-tabs { margin-left: 0; }
}
@media (max-width: 600px) { .lib-tabs { margin-left: clamp(18px, 3vw, 36px); } }
@media (max-width: 420px) {
  .lib-hero { grid-template-columns: minmax(360px, auto) 1fr !important; }
  .library-app .lib-hero .identity-cell { min-width: 360px !important; }
  .lib-tabs { margin-left: clamp(10px, 2vw, 22px); }
  .lib-tab {
    height: clamp(28px, 7vw, 38px);
    padding-inline: clamp(6px, 1.8vw, 14px);
    font-size: clamp(11px, 3.4vw, 14px);
  }
}

/* =========================
   Work area (4 equal cols)
   ========================= */
.library-app .lib-row {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 16px;
  padding: 16px var(--pad-x);
  align-items: start;
  min-width: 0;
}
@media (max-width: 820px) { .library-app .lib-row { gap: 12px; } }
.library-app .lib-col { min-width: 0; }

/* Card: cover + 5 lines (grid) */
/* IMPORTANT: overflow hidden so the card/book NEVER grows. */
.library-app .lib-card {
  container-type: inline-size;
  container-name: libcol;

  --card-h: clamp(135px, 40cqw, 180px) !important;
  --rows: 5;
  --row-gap: 8px;
  --row-h: calc((var(--card-h) - ((var(--rows) - 1) * var(--row-gap))) / var(--rows));

  display: grid;
  grid-template-columns: calc(var(--card-h) * 2 / 3) 1fr; /* cover | details */
  gap: 12px;
  height: var(--card-h);
  min-width: 0;
  overflow: hidden; /* keep size fixed */
}

/* Cover (2:3 ratio, stretches to card height) */
.library-app .lib-cover {
  width: 100%; height: 100%;
  background: #2a2a2a; border-radius: 4px; overflow: hidden;
}

/* Details: 5 equal rows (also fixed) */
.library-app .lib-details {
  display: grid; grid-template-rows: repeat(5, 1fr);
  gap: var(--row-gap); height: 100%; min-width: 0;
  overflow: hidden; /* prevent stretch */
}
.library-app .lib-line {
  display: flex; align-items: center;
  padding: 8px 10px;
  border: 1px solid rgba(255,255,255,0.12);
  border-radius: 6px;
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis; line-height: 1.2;
}
@media (max-width: 720px) {
  .library-app .lib-card { gap: 10px; }
  .library-app .lib-details { gap: 6px; }
  .library-app .lib-line { padding: 6px 8px; }
}

/* =========================
   Inline actions (icons + counts)
   ========================= */
.lib-row-actions.is-inline {
  display: flex; align-items: center; justify-content: flex-start;
  gap: 8px !important;
  min-height: 44px;
  padding: 0 !important;
  flex-wrap: nowrap !important;
  min-width: 0;
  overflow: visible;   /* popover can overlap rows */
  font-size: 16px;     /* row scale (em) */
}

.lib-row-actions.is-inline .meta-icon-btn {
  display: inline-flex !important;
  align-items: center !important;
  flex-direction: row !important;
  flex-wrap: nowrap !important;
  gap: 4px !important;
  padding: 0 !important;
  flex: 0 0 auto;
  white-space: nowrap;
}
.lib-row-actions.is-inline .meta-icon-btn > * {
  display: inline-block !important;
  width: auto !important;
  flex: 0 0 auto !important;
}

.lib-row-actions.is-inline .meta-icon-glyph { font-size: 1.78em !important; line-height: 1; }
.lib-row-actions.is-inline .meta-icon-count { font-size: 1.14em !important; line-height: 1; margin-left: 2px !important; }

/* Active colors */
.meta-icon-btn.is-active.like .meta-icon-glyph { --ms-fill: 1; color: #d81b60; }
.meta-icon-btn.is-active.save .meta-icon-glyph { --ms-fill: 1; color: #6a1b9a; }
.meta-icon-btn.is-active.star .meta-icon-glyph { --ms-fill: 1; color: #f2ac15; }

.lib-row-actions.is-inline .meta-icon-btn:hover .meta-icon-glyph { filter: drop-shadow(0 0 .4px rgba(255,255,255,.35)); }
.lib-row-actions.is-inline .meta-icon-btn:active .meta-icon-glyph { transform: translateY(1px) scale(.98); }

@media (max-width: 520px) {
  .lib-row-actions.is-inline { flex-wrap: wrap; row-gap: 10px; }
}

@container libcol (max-width: 660px) {
  .lib-row-actions.is-inline { font-size: clamp(12px, 2.2cqw, 16px); gap: 6px !important; }
  .lib-row-actions.is-inline .meta-icon-btn { gap: 3px !important; }
}
@container libcol (max-width: 520px) {
  .lib-row-actions.is-inline { font-size: clamp(11px, 2.8cqw, 15px); gap: 5px !important; }
  .lib-row-actions.is-inline .meta-icon-btn { gap: 2px !important; }
}
@container libcol (max-width: 420px) {
  .lib-row-actions.is-inline { font-size: clamp(10px, 3.4cqw, 14px); gap: 4px !important; }
}

/* =========================
   STAR POPOVER â€” body-level portal
   (never affects layout; never clipped)
   ========================= */

/* Full-screen, click-through overlay. You only click the surface. */
.pm-star-portal {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 1600; /* above cards/rails */
}

/* The actual bubble; positioned by inline top/left from the component. */
.pm-star-surface {
  position: fixed;                 /* OUTSIDE layout flow */
  top: var(--pm-top, 0px);         /* set via inline style */
  left: var(--pm-left, 0px);       /* set via inline style */
  transform: translate(-50%, -10px);
  pointer-events: auto;
  background: rgba(20, 20, 20, 0.96);
  border: 1px solid rgba(255,255,255,.18);
  border-radius: 10px;
  padding: 10px 12px;
  box-shadow: 0 10px 28px rgba(0,0,0,.5);
  min-width: 180px;
}

/* Stars row + hover preview */
.pm-star-row {
  display: inline-flex;
  gap: 6px;
  align-items: center;
  justify-content: center;
  font-size: 22px;
  user-select: none;
}
.pm-star-row[data-hover="1"] .pm-star:nth-child(-n+1),
.pm-star-row[data-hover="2"] .pm-star:nth-child(-n+2),
.pm-star-row[data-hover="3"] .pm-star:nth-child(-n+3),
.pm-star-row[data-hover="4"] .pm-star:nth-child(-n+4),
.pm-star-row[data-hover="5"] .pm-star:nth-child(-n+5) { color: #ffd36a; }

/* Star buttons */
.pm-star {
  appearance: none;
  background: transparent;
  border: 0;
  cursor: pointer;
  padding: 0 2px;
  line-height: 1;
  font-size: inherit;
  color: #8c8c8c;
  transition: transform 120ms ease, color 120ms ease;
}
.pm-star:hover { transform: translateY(-1px); }
.pm-star.is-on { color: #f2ac15; }

.pm-star-hint {
  margin-top: 6px;
  font-size: 12px;
  opacity: .85;
  text-align: center;
}

/* (Optional) legacy .lib-actions */
.library-app .lib-actions {
  display: inline-flex; align-items: center;
  gap: 8px !important; white-space: nowrap; min-width: 0; overflow: hidden; height: 100%;
  font-size: clamp(12px, 1.6vw, 16px) !important;
}
.library-app .lib-actions .meta-icon-btn {
  display: inline-flex !important; align-items: center !important;
  height: var(--row-h) !important; max-height: var(--row-h) !important;
  padding: 0 !important; gap: clamp(2px, 0.6vw, 6px) !important;
  white-space: nowrap; box-sizing: border-box; overflow: hidden; flex: 0 0 auto;
}
.library-app .lib-actions .meta-icon-glyph { font-size: 1em !important; line-height: 1; }
.library-app .lib-actions .meta-icon-count { font-size: 0.85em !important; line-height: 1; margin-left: 4px; }
@media (max-width: 900px) { .library-app .lib-actions { font-size: clamp(11px, 1.8vw, 14px) !important; } }
@media (max-width: 700px) { .library-app .lib-actions { font-size: clamp(10px, 2.4vw, 13px) !important; } }

/* =========================
   End
   ========================= */
